<article class="markdown">
  <h1>
	定制主题
	<span class="subtitle"></span>
</h1>

<nz-affix class="toc-affix" [nzOffsetTop]="16">
  <nz-anchor [nzAffix]="false" nzShowInkInFixed (nzClick)="goLink($event)">
    <nz-link nzHref="#使用预定义主题" nzTitle="使用预定义主题"></nz-link><nz-link nzHref="#修改预定义主题" nzTitle="修改预定义主题"></nz-link><nz-link nzHref="#动态切换主题" nzTitle="动态切换主题"></nz-link><nz-link nzHref="#q&a" nzTitle="Q&A"></nz-link>
  </nz-anchor>
</nz-affix>
  <section class="markdown" ngNonBindable><p>Ant Design 设计规范上支持一定程度的样式定制，以满足业务和品牌上多样化的视觉需求，包括但不限于主色、圆角、边框和部分组件的视觉定制。</p>
<p><img src="https://zos.alipayobjects.com/rmsportal/zTFoszBtDODhXfLAazfSpYbSLSEeytoG.png" alt="Example"></p>
<p>Ant Design 的样式使用了 <a href="https://lesscss.org/" target="_blank" rel="noopener">Less</a> 作为开发语言，并定义了一系列全局/组件的样式变量，你可以根据需求进行相应调整，<a href="https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/components/style/themes/default.less" target="_blank" rel="noopener">默认样式变量</a></p>
<blockquote>
<p>Ant Design React 的主题定制文件在 <code>ng-zorro-antd</code> 中同样可以使用。</p>
</blockquote>
<h2 id="使用预定义主题"><span>使用预定义主题</span><a onclick="window.location.hash = '使用预定义主题'" class="anchor">#</a></h2><h3 id="配置非定制主题"><span>配置非定制主题</span><a onclick="window.location.hash = '配置非定制主题'" class="anchor">#</a></h3><p>在初始化项目时，运行 <code>ng add ng-zorro-antd</code> 命令之后，选择不配置自定义主题文件，你的项目则会自动在 <code>angular.json</code> 中配置：</p>
<pre><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"build"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"options"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"styles"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./node_modules/ng-zorro-antd/ng-zorro-antd.min.css"</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</code></pre><p>当然，你也可以在 <code>angular.json</code> 中手动添加该配置。</p>
<h3 id="官方主题"><span>官方主题</span><a onclick="window.location.hash = '官方主题'" class="anchor">#</a></h3><p>除了默认主题外，我们还提供了三种官方主题，欢迎在项目中试用，并且给我们提供反馈。</p>
<ul>
<li>🌑 暗黑主题</li>
<li>📦 紧凑主题</li>
<li>☁️ 阿里云主题</li>
</ul>
<h4 id="方式一：_less"><span>方式一： Less</span><a onclick="window.location.hash = '方式一：_less'" class="anchor">#</a></h4><p>在样式文件全量，如 <code>style.less</code>，中引入 <code>ng-zorro-antd.less</code>、<code>ng-zorro-antd.dark.less</code>、<code>ng-zorro-antd.compact.less</code> 或 <code>ng-zorro-antd.aliyun.less</code> 覆盖主题变量。</p>
<pre><code class="language-less"><span class="token comment">// 引入官方提供的默认 less 样式文件</span>
<span class="token variable">&#64;import</span> <span class="token string">'~ng-zorro-antd/ng-zorro-antd.less'</span><span class="token punctuation">;</span>

<span class="token comment">// 引入官方提供的暗黑 less 样式文件</span>
<span class="token comment">//&#64;import "~ng-zorro-antd/ng-zorro-antd.dark.less";</span>

<span class="token comment">// 引入官方提供的紧凑 less 样式文件</span>
<span class="token comment">//&#64;import "~ng-zorro-antd/ng-zorro-antd.compact.less";</span>

<span class="token comment">// 引入官方提供的阿里云 less 样式文件</span>
<span class="token comment">//&#64;import "~ng-zorro-antd/ng-zorro-antd.aliyun.less";</span>
</code></pre><h4 id="方式二_css"><span>方式二: CSS</span><a onclick="window.location.hash = '方式二_css'" class="anchor">#</a></h4><p>如果项目不使用 Less，可在 CSS 文件或者 <code>angular.json</code> 的 <code>styles</code> 字段中，全量引入 <code>ng-zorro-antd.css</code>、<code>ng-zorro-antd.dark.css</code>、<code>ng-zorro-antd.compact.css</code> 或者 <code>ng-zorro-antd.aliyun.css</code>。</p>
<p>样式文件中：</p>
<pre><code class="language-css"><span class="token atrule"><span class="token rule">&#64;import</span> <span class="token string">'~ng-zorro-antd/ng-zorro-antd.css'</span><span class="token punctuation">;</span></span>
<span class="token comment">/*&#64;import "~ng-zorro-antd/ng-zorro-antd.dark.css";*/</span>
<span class="token comment">/*&#64;import "~ng-zorro-antd/ng-zorro-antd.compact.css";*/</span>
<span class="token comment">/*&#64;import "~ng-zorro-antd/ng-zorro-antd.aliyun.css";*/</span>
</code></pre><p><code>angular.json</code> 中：</p>
<pre><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"build"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"options"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"styles"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"node_modules/ng-zorro-antd/ng-zorro-antd.css"</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</code></pre><h2 id="修改预定义主题"><span>修改预定义主题</span><a onclick="window.location.hash = '修改预定义主题'" class="anchor">#</a></h2><h3 id="方式一：在_less_中覆盖主题变量"><span>方式一：在 Less 中覆盖主题变量</span><a onclick="window.location.hash = '方式一：在_less_中覆盖主题变量'" class="anchor">#</a></h3><h4 id="引入预定义主题文件"><span>引入预定义主题文件</span><a onclick="window.location.hash = '引入预定义主题文件'" class="anchor">#</a></h4><p>在 <code>src/styles.less</code> 里引入预定义主题文件 （也可以在初始化项目运行 <code>ng add ng-zorro-antd</code> 命令之后，选择配置自定义主题文件）：</p>
<pre><code class="language-less"><span class="token comment">// Custom Theming for NG-ZORRO</span>
<span class="token comment">// For more information: https://ng.ant.design/docs/customize-theme/en</span>
<span class="token variable">&#64;import</span> <span class="token string">'../node_modules/ng-zorro-antd/ng-zorro-antd.less'</span><span class="token punctuation">;</span>
</code></pre><h4 id="自定义样式变量"><span>自定义样式变量</span><a onclick="window.location.hash = '自定义样式变量'" class="anchor">#</a></h4><p>引入官方主题文件之后，再根据实际需求自定义覆盖主题样式变量的参数。例如，在以下样例中通过修改 <code>&#64;primary-color</code> 的数值将预定义默认主题的基础色修改为 <code>#f5222d</code>：</p>
<pre><code class="language-less"><span class="token comment">// -------- 引入官方提供的 less 样式入口文件 -----------</span>
<span class="token variable">&#64;import</span> <span class="token string">'../node_modules/ng-zorro-antd/ng-zorro-antd.less'</span><span class="token punctuation">;</span>

<span class="token comment">// -------- 自定义参数覆盖 -----------</span>
<span class="token variable">&#64;primary-color<span class="token punctuation">:</span></span> #f5222d<span class="token punctuation">;</span>
</code></pre><h3 id="方式二：webpack_中覆盖主题变量"><span>方式二：webpack 中覆盖主题变量</span><a onclick="window.location.hash = '方式二：webpack_中覆盖主题变量'" class="anchor">#</a></h3><h4 id="覆盖为预定义主题变量"><span>覆盖为预定义主题变量</span><a onclick="window.location.hash = '覆盖为预定义主题变量'" class="anchor">#</a></h4><p>在 webpack 中使用 less-loader 按需引入：</p>
<pre><code class="language-javascript"><span class="token keyword">const</span> darkThemeVars <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ng-zorro-antd/dark-theme'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compactThemeVars <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ng-zorro-antd/compact-theme'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">modifyVars</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">hack</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">true;&#64;import "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ng-zorro-antd/style/color/colorPalette.less'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">";</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token operator">...</span>darkThemeVars<span class="token punctuation">,</span>
            <span class="token operator">...</span>compactThemeVars
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">javascriptEnabled</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
</code></pre><h4 id="覆盖为定制主题变量"><span>覆盖为定制主题变量</span><a onclick="window.location.hash = '覆盖为定制主题变量'" class="anchor">#</a></h4><p>Angular CLI 提供了 <a href="https://www.npmjs.com/package/&#64;angular-builders/custom-webpack" target="_blank" rel="noopener">custom-webpack</a> 的 builder，可以通过该 builder 轻松的调整 webpack 中 <a href="https://github.com/webpack-contrib/less-loader" target="_blank" rel="noopener">less-loader</a> 的配置来进行主题配置。</p>
<ol>
<li><p>在 <code>angular.json</code> 中引入 <code>ng-zorro-antd.less</code> 文件</p>
<pre><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"styles"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"node_modules/ng-zorro-antd/ng-zorro-antd.less"</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
</code></pre></li>
<li><p>安装 <code>&#64;angular-builders/custom-webpack</code> builder</p>
<pre><code class="language-bash"><span class="token function">npm</span> i -D &#64;angular-builders/custom-webpack
</code></pre></li>
<li><p>新建 webpack 配置文件 <code>extra-webpack.config.js</code></p>
<pre><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">modifyVars</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 修改主题变量</span>
            <span class="token string-property property">'primary-color'</span><span class="token operator">:</span> <span class="token string">'#1DA57A'</span><span class="token punctuation">,</span>
            <span class="token string-property property">'link-color'</span><span class="token operator">:</span> <span class="token string">'#1DA57A'</span><span class="token punctuation">,</span>
            <span class="token string-property property">'border-radius-base'</span><span class="token operator">:</span> <span class="token string">'2px'</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">javascriptEnabled</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
</code></pre></li>
<li><p>在 <code>angular.json</code> 中配置自定义 builder</p>
<pre><code class="language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> "architect": &#123;
</span><span class="token prefix unchanged"> </span><span class="token line">   "build": &#123;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">     "builder": "&#64;angular-devkit/build-angular:browser",
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     "builder": "&#64;angular-builders/custom-webpack:browser",
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     "options": &#123;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">        "customWebpackConfig": &#123;
</span><span class="token prefix inserted">+</span><span class="token line">          "path": "./extra-webpack.config.js",
</span><span class="token prefix inserted">+</span><span class="token line">          "mergeStrategies": &#123;
</span><span class="token prefix inserted">+</span><span class="token line">            "module.rules": "append"
</span><span class="token prefix inserted">+</span><span class="token line">          &#125;,
</span><span class="token prefix inserted">+</span><span class="token line">          "replaceDuplicatePlugins": true
</span><span class="token prefix inserted">+</span><span class="token line">        &#125;
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">     &#125;,
</span><span class="token prefix unchanged"> </span><span class="token line">   &#125;,
</span><span class="token prefix unchanged"> </span><span class="token line">   "serve": &#123;
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">      "builder": "&#64;angular-devkit/build-angular:dev-server",
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">      "builder": "&#64;angular-builders/custom-webpack:dev-server",
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   &#125;
</span><span class="token prefix unchanged"> </span><span class="token line"> &#125;</span></span>
</code></pre></li>
</ol>
<p>更多在 Angular CLI 中定制 webpack 的文章可以参考</p>
<ul>
<li><a href="https://www.npmjs.com/package/&#64;angular-builders/custom-webpack" target="_blank" rel="noopener">Angular Builder Document</a></li>
<li><a href="https://alligator.io/angular/custom-webpack-config/" target="_blank" rel="noopener">Angular CLI: Custom webpack Config</a></li>
<li><a href="https://netbasal.com/customize-webpack-configuration-in-your-angular-application-d09683f6bd22" target="_blank" rel="noopener">Customize Webpack Configuration in Your Angular Application</a></li>
</ul>
<p>全部可被自定义 less 变量可以参考 <a href="https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/components/style/themes/default.less" target="_blank" rel="noopener">这里</a>。</p>
<h2 id="动态切换主题"><span>动态切换主题</span><a onclick="window.location.hash = '动态切换主题'" class="anchor">#</a></h2><p>我们为你准备了一个演示动态切换主题的项目，欢迎前往 <a href="https://github.com/yangjunhan/nz-themes" target="_blank" rel="noopener">这里</a> 查看。</p>
<h3 id="配置_angularjson_文件"><span>配置 angular.json 文件</span><a onclick="window.location.hash = '配置_angularjson_文件'" class="anchor">#</a></h3><ol>
<li><p>样式预处理器选项 <code>stylePreprocessorOptions</code></p>
<p>在<code>angular.json</code> 中配置样式预处理器选项 <code>stylePreprocessorOptions</code> 并添加路径：</p>
<pre><code class="language-json"><span class="token property">"stylePreprocessorOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  <span class="token property">"includePaths"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"src/styles/themes"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
</code></pre><p>于是，在项目组件样式文件里，无需相对路径，<code>src/styles/themes</code> 路径下的任意文件定义文件都可以从项目中的任何位置导入，例如：</p>
<pre><code class="language-less"><span class="token comment">// A relative path works</span>
<span class="token variable">&#64;import</span> <span class="token string">'src/styles/themes/mixin'</span><span class="token punctuation">;</span>
<span class="token comment">// But now this works as well</span>
<span class="token variable">&#64;import</span> <span class="token string">'mixin'</span><span class="token punctuation">;</span>
</code></pre></li>
<li><p>styles 里的 <code>bundleName</code> 和 <code>inject</code></p>
<p>如果需要在项目运行时动态切换主题，你就需要为构建器配置好每个主题的全局上下文样式文件。继续以默认和暗黑主题为例，请在 <code>angular.json</code> 的 <code>styles</code> 选项数组里进行如下配置：</p>
<pre><code class="language-json"><span class="token property">"styles"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">"src/styles.less"</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"input"</span><span class="token operator">:</span> <span class="token string">"src/styles/default.less"</span><span class="token punctuation">,</span>
    <span class="token property">"bundleName"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
    <span class="token property">"inject"</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"input"</span><span class="token operator">:</span> <span class="token string">"src/styles/dark.less"</span><span class="token punctuation">,</span>
    <span class="token property">"bundleName"</span><span class="token operator">:</span> <span class="token string">"dark"</span><span class="token punctuation">,</span>
    <span class="token property">"inject"</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><p><code>bundleName</code> 指捆绑包的自定义 CSS 文件名称，方便了之后切换主题创建所需的 link 标签的 href 属性。<code>inject</code> 默认为 <code>true</code>，会将捆绑包注入。为了动态主题切换则需要将主题捆绑包从注入中排除。</p>
</li>
</ol>
<h3 id="多主题定制"><span>多主题定制</span><a onclick="window.location.hash = '多主题定制'" class="anchor">#</a></h3><p>在多主题项目的情景下，每一个主题都应该创建一个单独的样式入口文件。为了更好管理多主题项目，我们推荐将所有类似的主题定义入口文件放在 <code>src/styles</code> 路径下。例如，当你的项目有默认和暗黑主题时，你的项目 styles 可能会是以下结构：</p>
<pre>
  src/styles
  ├── dark.less
  ├── default.less
  └── themes
      ├── base.less
      ├── dark.less
      ├── default.less
      └── mixin.less
</pre>

<p><code>src/styles/</code> 下的主题文件是主题入口文件，它的作用是引入预定义官方 Less 样式入口文件以及 <code>src/styles/themes/</code> 下对应的主题样式定制文件。例如，<code>src/styles/dark.less</code> 入口文件含有以下代码：</p>
<pre><code class="language-less"><span class="token variable">&#64;import</span> <span class="token string">'../../node_modules/ng-zorro-antd/ng-zorro-antd'</span><span class="token punctuation">;</span>
<span class="token variable">&#64;import</span> <span class="token string">'./themes/dark'</span><span class="token punctuation">;</span>
</code></pre><p>相应的，<code>src/styles/themes/dark.less</code> 文件负责定制暗黑主题的样式：</p>
<pre><code class="language-less"><span class="token variable">&#64;import</span> <span class="token punctuation">(</span>multiple<span class="token punctuation">)</span> <span class="token string">'../../../node_modules/ng-zorro-antd/src/style/themes/dark'</span><span class="token punctuation">;</span>
<span class="token variable">&#64;import</span> <span class="token string">'./base'</span><span class="token punctuation">;</span>

<span class="token variable">&#64;layout-sider-background<span class="token punctuation">:</span></span> <span class="token variable">&#64;component-background</span><span class="token punctuation">;</span>
<span class="token variable">&#64;layout-header-background<span class="token punctuation">:</span></span> <span class="token variable">&#64;component-background</span><span class="token punctuation">;</span>
</code></pre><blockquote>
<p>当引入对应的预定义主题样式变量文件的时候，会遇到 <code>.less</code> 样式文件名跟项目自己的主题样式文件名是一样的情况，这样的话单单使用 <code>&#64;import &#39;&lt;url&gt;&#39;;</code> 是无法生效的。这种时候， Less 为我们提供了 <code>&#64;import (multiple) &#39;&lt;url&gt;&#39;;</code> 的 <code>multiple</code> 方法来引入这些同名的 <code>.less</code> 文件。</p>
</blockquote>
<p>注意，如果存在所有主题通用的样式变量，还可以引入一个统一的 <code>base.less</code> 基本样式文件并在每个主题样式定制文件中引入它：</p>
<pre><code class="language-less"><span class="token comment">// base.less 定制通用样式变量</span>
<span class="token variable">&#64;margin-md<span class="token punctuation">:</span></span> 17px<span class="token punctuation">;</span>
</code></pre><h3 id="切换主题"><span>切换主题</span><a onclick="window.location.hash = '切换主题'" class="anchor">#</a></h3><p>切换主题包括两部分，一是切换项目组件主题，二是切换预定义主题。</p>
<h4 id="切换项目组件主题"><span>切换项目组件主题</span><a onclick="window.location.hash = '切换项目组件主题'" class="anchor">#</a></h4><p>Angular 目前默认的模板和 CSS 样式使用的样式封装策略是 <code>ViewEncapsulation.Emulated</code>，也就是使用垫片 CSS 来模拟原生行为。根据不同的样式封装策略，Angular 会将项目组件样式以不同方式打包进 JS 文件里。</p>
<p>切换项目组件主题的策略是在定制项目组件样式时，会通过 html 里的代表主题 class 的 <code>className</code>，例如 <code>default</code> 和 <code>dark</code>，以切换打包好的主题。</p>
<p>但是，在每一个项目组件样式文件里根据以下格式写样式会很繁琐：</p>
<pre><code class="language-less"><span class="token selector">html</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">&amp;.default</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">&#64;import</span> <span class="token string">'default'</span><span class="token punctuation">;</span>
    <span class="token comment">// 组件样式</span>
    ...<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">&amp;.dark</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">&#64;import</span> <span class="token string">'dark'</span><span class="token punctuation">;</span>
    <span class="token comment">// 组件样式</span>
    ...<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</code></pre><blockquote>
<p>注意，由于已经配置了样式预处理器选项 <code>stylePreprocessorOptions</code> 里的路径 <code>src/styles/themes</code>，这里的 <code>&#64;import</code> 不需要完整的相对路径。</p>
</blockquote>
<p>更好的实现方式是，在上文提到的 <code>mixin.less</code> 中定义一个 Mixin <code>.themeMixin(&#64;rules)</code>：</p>
<pre><code class="language-less"><span class="token selector">.themeMixin(<span class="token variable">&#64;rules</span>)</span> <span class="token punctuation">&#123;</span>
  <span class="token selector">html</span> <span class="token punctuation">&#123;</span>
    <span class="token selector">&amp;.default</span> <span class="token punctuation">&#123;</span>
      <span class="token variable">&#64;import</span> <span class="token string">'./default.less'</span><span class="token punctuation">;</span>
      <span class="token variable">&#64;rules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token selector">&amp;.dark</span> <span class="token punctuation">&#123;</span>
      <span class="token variable">&#64;import</span> <span class="token string">'./dark.less'</span><span class="token punctuation">;</span>
      <span class="token variable">&#64;rules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</code></pre><p>并在所有的项目组件样式文件里，只需要将所有样式传入 <code>.themeMixin(&#64;rules)</code> 里即可：</p>
<pre><code class="language-less"><span class="token variable">&#64;import</span> <span class="token string">'mixin'</span><span class="token punctuation">;</span> <span class="token comment">// 同样的，不需要完整的相对路径</span>

.themeMixin<span class="token selector">(</span><span class="token punctuation">&#123;</span>
  <span class="token selector">:host</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 组件样式</span>
    ...
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="切换预定义主题"><span>切换预定义主题</span><a onclick="window.location.hash = '切换预定义主题'" class="anchor">#</a></h4><p>切换预定义主题样式文件则是需要动态创建 <code>link</code> 标签，将样式文件动态加载在应用中，并移除上个主题的 <code>link</code> 标签。</p>
<pre><code class="language-ts"><span class="token keyword">private</span> <span class="token function">loadCss</span><span class="token punctuation">(</span>href<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Event<span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> style <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    style<span class="token punctuation">.</span>rel <span class="token operator">=</span> <span class="token string">'stylesheet'</span><span class="token punctuation">;</span>
    style<span class="token punctuation">.</span>href <span class="token operator">=</span> href<span class="token punctuation">;</span>
    style<span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    style<span class="token punctuation">.</span>onload <span class="token operator">=</span> resolve<span class="token punctuation">;</span>
    style<span class="token punctuation">.</span>onerror <span class="token operator">=</span> reject<span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
</code></pre><p>这里的 <code>href</code> 将指代上文配置的<a href="/docs/customize-theme/zh#%E9%85%8D%E7%BD%AE-angular-json-%E6%96%87%E4%BB%B6">捆绑包</a>的路径，也就是 <code>bundleName</code>的路径。</p>
<h4 id="同步两种主题切换"><span>同步两种主题切换</span><a onclick="window.location.hash = '同步两种主题切换'" class="anchor">#</a></h4><p>项目组件样式会被打包进 js 文件，因此在切换 html 的 <code>className</code> 的时候主题样式会立即生效。另一方面，动态地加载 CSS 预定义主题文件却是需要时间完成的。如果两个操作同时进行，页面则会出现一部分是立即生效的项目组件样式，另一部分是切换主题加载之前的样式。因此，整个切换主题 <code>className</code> 操作需要包裹在 <code>Promise</code> 里等待 CSS 文件加载完成后才执行。</p>
<pre><code class="language-ts"><span class="token keyword">private</span> <span class="token function">removeUnusedTheme</span><span class="token punctuation">(</span>theme<span class="token operator">:</span> ThemeType<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
  document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> removedThemeStyle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>removedThemeStyle<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>removedThemeStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">loadTheme</span><span class="token punctuation">(</span>firstLoad <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Event<span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentTheme<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>firstLoad<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadCss</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>theme<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.css</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> theme<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    e <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>firstLoad<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>theme<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeUnusedTheme</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>previousTheme<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    e <span class="token operator">=></span> <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
</code></pre><p>注意：第一次加载首先需要先将用户默认的项目组件主题加入 html 里，而不是包进 Promise 里，否则开始有一段时间会出现没有主题 <code>className</code> 的情况。</p>
<h2 id="qandamp;a"><span>Q&amp;A</span><a onclick="window.location.hash = 'qandamp;a'" class="anchor">#</a></h2></section>
</article>